  // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
window.addEventListener("DOMContentLoaded", () => {
  restoreFilters();

  const savedTheme = localStorage.getItem("theme");
  applyTheme(savedTheme === "dark");

  const themeSwitch = document.getElementById("theme-switch");
  if (themeSwitch) {
    themeSwitch.addEventListener("click", () => {
      const root = document.documentElement;
      const currentTheme = root.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";
      root.setAttribute("data-theme", newTheme);
      localStorage.setItem("theme", newTheme);
    });
  }

  flatpickr("#start-date", {
    dateFormat: "Y-m-d",
    allowInput: false,
    locale: "ru"
  });
  flatpickr("#end-date", {
    dateFormat: "Y-m-d",
    allowInput: false,
    locale: "ru"
  });

  document.querySelectorAll(".input-with-icon").forEach(group => {
    const input = group.querySelector("input");
    const iconBtn = group.querySelector(".calendar-wrapper");
    if (input && iconBtn) {
      iconBtn.addEventListener("click", () => {
        if (input._flatpickr) {
          input._flatpickr.open();
        }
      });
    }
  });

  applyFilters();
  startAutoRefresh(30000);

  // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  document.getElementById("show-btn")?.addEventListener("click", () => {
    saveFilters();
    applyFilters();
  });

  document.getElementById("clear-btn")?.addEventListener("click", () => {
    localStorage.removeItem("filters");
    document.getElementById("filter-form").reset();
    clearFilters();
  });

  document.getElementById("export-excel")?.addEventListener("click", exportExcel);
  document.getElementById("export-png")?.addEventListener("click", exportPng);
  document.getElementById("export-md")?.addEventListener("click", exportMarkdown);
  document.getElementById("export-pdf")?.addEventListener("click", exportPdf);

  logEvent("üì¶ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: —Ñ–∏–ª—å—Ç—Ä—ã/—Ç–µ–º–∞/–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã");
});
